<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Tracker - Smart Money Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4C4BCB'
                    }
                }
            }
        }
    </script>
    <style>
        .hide { display: none !important; }
        .fade-in { animation: fadeIn 0.2s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        input:focus { outline: none; }
        .transaction-item { transition: all 0.15s ease; }
        .transaction-item:hover { transform: translateY(-1px); }
        .calculator-btn { transition: all 0.1s ease; }
        .calculator-btn:hover { transform: scale(1.05); }
        .calculator-btn:active { transform: scale(0.95); }
        .tab-btn.active {
            background-color: #5D5CDE;
            color: white;
            box-shadow: 0 2px 8px rgba(93, 92, 222, 0.3);
        }
        .tab-btn {
            color: #6B7280;
            background-color: transparent;
            transition: all 0.2s ease;
            flex: 1;
            min-width: 0;
        }
        .tab-btn:hover:not(.active) {
            background-color: #F3F4F6;
            color: #374151;
        }
        .dark .tab-btn:hover:not(.active) {
            background-color: #4B5563;
            color: #D1D5DB;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #5D5CDE 0%, #4C4BCB 100%);
        }
        .card-hover {
            transition: all 0.2s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .dark .card-hover:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        .pulse-ring {
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 1; }
            100% { transform: scale(2.4); opacity: 0; }
        }
        .emoji-bounce {
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }
        .tab-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 4px;
        }
        @media (max-width: 640px) {
            .tab-btn span:last-child {
                font-size: 0.75rem;
            }
        }
        .health-score {
            background: linear-gradient(45deg, #10B981, #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .alert-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .budget-warning {
            border-left: 4px solid #F59E0B;
        }
        .budget-danger {
            border-left: 4px solid #EF4444;
        }
        /* Fix chart container to prevent scroll issues */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            overflow: hidden;
        }
        .chart-container canvas {
            display: block !important;
            height: 300px !important;
            width: 100% !important;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen">
    <!-- Header Navigation -->
    <header class="gradient-bg text-white shadow-xl sticky top-0 z-40">
        <div class="px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="bg-white bg-opacity-20 p-2 rounded-xl relative">
                        <span class="text-2xl emoji-bounce">💰</span>
                        <div class="absolute inset-0 bg-white opacity-20 rounded-xl pulse-ring"></div>
                    </div>
                    <div>
                        <h1 id="appTitle" class="text-xl font-bold">Budget Tracker Pro</h1>
                        <p id="appSubtitle" class="text-sm text-white text-opacity-80">Advanced Money Management</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <!-- Health Score Badge -->
                    <div id="healthScoreBadge" class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-xs font-bold">
                        💚 <span id="healthScore">85</span>
                    </div>
                    <!-- Language Switcher -->
                    <select id="languageSelect" class="bg-white bg-opacity-20 text-white text-xs rounded-lg p-2 border-0">
                        <option value="en">🇺🇸 EN</option>
                        <option value="ne">🇳🇵 NE</option>
                    </select>
                    <button id="calculatorBtn" class="p-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all">
                        <i class="fas fa-calculator text-sm"></i>
                    </button>
                    <button id="searchBtn" class="p-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all">
                        <i class="fas fa-search text-sm"></i>
                    </button>
                    <button id="menuBtn" class="p-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all">
                        <i class="fas fa-ellipsis-v text-sm"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Search Bar -->
        <div id="searchBar" class="px-4 pb-4 hide">
            <div class="relative">
                <input type="text" id="searchInput" class="w-full px-4 py-2 pl-10 bg-white bg-opacity-20 rounded-lg text-white placeholder-white placeholder-opacity-70 border border-white border-opacity-30 focus:border-opacity-50 text-base" placeholder="Search transactions...">
                <i class="fas fa-search absolute left-3 top-2.5 text-white text-opacity-70"></i>
            </div>
        </div>

        <!-- Smart Insights Alert -->
        <div id="smartInsights" class="px-4 pb-2 hide">
            <div class="bg-yellow-500 bg-opacity-20 border border-yellow-400 rounded-lg p-3 alert-pulse">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-lightbulb text-yellow-300"></i>
                    <span id="insightText" class="text-sm font-medium"></span>
                </div>
            </div>
        </div>
    </header>

    <!-- Menu Dropdown -->
    <div id="menuDropdown" class="hide fixed top-20 right-4 bg-white dark:bg-gray-800 rounded-xl shadow-xl z-50 min-w-48">
        <div class="py-2">
            <button id="exportBtn" class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2">
                <i class="fas fa-download"></i>
                <span id="exportText">Export Data</span>
            </button>
            <button id="importBtn" class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2">
                <i class="fas fa-upload"></i>
                <span id="importText">Import Data</span>
            </button>
            <button id="backupBtn" class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2">
                <i class="fas fa-cloud-upload-alt"></i>
                <span id="backupText">Backup to Cloud</span>
            </button>
            <button id="privacyBtn" class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2">
                <i class="fas fa-shield-alt"></i>
                <span id="privacyText">Privacy Policy</span>
            </button>
            <button id="aboutBtn" class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2">
                <i class="fas fa-info-circle"></i>
                <span id="aboutText">About</span>
            </button>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="bg-white dark:bg-gray-800 px-4 py-3 shadow-lg border-b border-gray-200 dark:border-gray-600 sticky top-20 z-30">
        <div class="flex justify-between items-center">
            <div class="tab-container bg-gray-100 dark:bg-gray-900 p-1 rounded-xl shadow-inner w-full max-w-lg">
                <button id="dashboardTab" class="tab-btn active px-2 py-2 rounded-lg text-xs font-medium flex flex-col items-center space-y-1">
                    <span>📊</span><span id="dashboardTabText">Dashboard</span>
                </button>
                <button id="transactionsTab" class="tab-btn px-2 py-2 rounded-lg text-xs font-medium flex flex-col items-center space-y-1">
                    <span>💳</span><span id="transactionsTabText">Transactions</span>
                </button>
                <button id="budgetTab" class="tab-btn px-2 py-2 rounded-lg text-xs font-medium flex flex-col items-center space-y-1">
                    <span>📋</span><span id="budgetTabText">Budget</span>
                </button>
                <button id="analyticsTab" class="tab-btn px-2 py-2 rounded-lg text-xs font-medium flex flex-col items-center space-y-1">
                    <span>📈</span><span id="analyticsTabText">Analytics</span>
                </button>
                <button id="advancedTab" class="tab-btn px-2 py-2 rounded-lg text-xs font-medium flex flex-col items-center space-y-1">
                    <span>⚡</span><span id="advancedTabText">Advanced</span>
                </button>
            </div>
            <div class="ml-3">
                <select id="dateRangeFilter" class="px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-xs mr-2">
                    <option value="all">All Time</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="quarter">This Quarter</option>
                    <option value="year">This Year</option>
                    <option value="custom">Custom Range</option>
                </select>
                <select id="sortBy" class="px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-xs">
                    <option value="date">Sort by Date</option>
                    <option value="amount">Sort by Amount</option>
                    <option value="category">Sort by Category</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="p-4 pb-32">
        <!-- Dashboard Tab -->
        <div id="dashboardContent" class="tab-content">
            <div class="space-y-4">
                <!-- Financial Health Score -->
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-6 rounded-xl border border-green-200 dark:border-green-800 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-green-700 dark:text-green-300 text-lg font-bold mb-2">Financial Health Score</h3>
                            <div class="flex items-center space-x-4">
                                <div class="text-4xl font-bold health-score" id="healthScoreDisplay">85</div>
                                <div>
                                    <div class="w-24 bg-green-200 dark:bg-green-800 rounded-full h-3">
                                        <div id="healthScoreBar" class="bg-green-600 h-3 rounded-full transition-all duration-300" style="width: 85%"></div>
                                    </div>
                                    <p id="healthScoreText" class="text-sm text-green-600 dark:text-green-400 mt-1">Excellent</p>
                                </div>
                            </div>
                        </div>
                        <div class="text-5xl">💚</div>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="grid grid-cols-1 gap-4">
                    <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 p-4 rounded-xl border border-green-200 dark:border-green-800 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 id="totalIncomeLabel" class="text-green-700 dark:text-green-300 text-sm font-medium">Total Income</h3>
                                <p id="totalIncome" class="text-2xl font-bold text-green-800 dark:text-green-200">$0.00</p>
                                <p id="incomeChange" class="text-xs text-green-600 dark:text-green-400">+0% from last month</p>
                            </div>
                            <div class="text-3xl text-green-600">💰</div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 p-4 rounded-xl border border-red-200 dark:border-red-800 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 id="totalExpensesLabel" class="text-red-700 dark:text-red-300 text-sm font-medium">Total Expenses</h3>
                                <p id="totalExpenses" class="text-2xl font-bold text-red-800 dark:text-red-200">$0.00</p>
                                <p id="expenseChange" class="text-xs text-red-600 dark:text-red-400">+0% from last month</p>
                            </div>
                            <div class="text-3xl text-red-600">💸</div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 p-4 rounded-xl border border-blue-200 dark:border-blue-800 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 id="netBalanceLabel" class="text-blue-700 dark:text-blue-300 text-sm font-medium">Net Balance</h3>
                                <p id="netBalance" class="text-2xl font-bold text-blue-800 dark:text-blue-200">$0.00</p>
                                <p id="balanceChange" class="text-xs text-blue-600 dark:text-blue-400">+0% from last month</p>
                            </div>
                            <div class="text-3xl text-blue-600">🏦</div>
                        </div>
                    </div>
                </div>

                <!-- Bill Reminders -->
                <div id="billRemindersSection" class="bg-orange-50 dark:bg-orange-900/20 p-4 rounded-xl border border-orange-200 dark:border-orange-800 card-hover hide">
                    <h3 class="text-orange-700 dark:text-orange-300 text-lg font-semibold mb-3 flex items-center">
                        <span class="mr-2">⏰</span>Upcoming Bills
                    </h3>
                    <div id="upcomingBills" class="space-y-2"></div>
                </div>

                <!-- Budget Alerts -->
                <div id="budgetAlertsSection" class="space-y-2"></div>

                <!-- Recent Transactions -->
                <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm card-hover">
                    <h3 id="recentTransactionsLabel" class="text-lg font-semibold mb-3 flex items-center">
                        <span class="mr-2">🕒</span>Recent Transactions
                    </h3>
                    <div id="recentTransactions" class="space-y-2">
                        <p id="noTransactionsText" class="text-gray-500 dark:text-gray-400 text-center py-8">No transactions yet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div id="transactionsContent" class="tab-content hide">
            <div class="space-y-4">
                <!-- Filter Controls -->
                <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm">
                    <div class="grid grid-cols-2 gap-2">
                        <select id="filterType" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                            <option value="">All Types</option>
                            <option value="income">Income</option>
                            <option value="expense">Expense</option>
                        </select>
                        <select id="filterCategory" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    <div class="mt-3 flex space-x-2">
                        <button id="recurringTransactionsBtn" class="flex-1 px-3 py-2 bg-purple-100 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300 rounded-lg border border-purple-300 dark:border-purple-700 hover:bg-purple-200 dark:hover:bg-purple-900/40 transition-colors">
                            <i class="fas fa-sync-alt mr-2"></i>Recurring
                        </button>
                        <button id="addRecurringBtn" class="flex-1 px-3 py-2 bg-indigo-100 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300 rounded-lg border border-indigo-300 dark:border-indigo-700 hover:bg-indigo-200 dark:hover:bg-indigo-900/40 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Add Recurring
                        </button>
                    </div>
                </div>

                <!-- Transactions List -->
                <div id="transactionsList" class="space-y-2">
                    <p class="text-gray-500 dark:text-gray-400 text-center py-8">No transactions found</p>
                </div>
            </div>
        </div>

        <!-- Budget Tab -->
        <div id="budgetContent" class="tab-content hide">
            <div class="space-y-6">
                <!-- Budget Overview -->
                <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm card-hover">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">📊 Budget Overview</h3>
                        <button id="addBudgetBtn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
                            <i class="fas fa-plus mr-2"></i>Add Budget
                        </button>
                    </div>
                    <div id="budgetList" class="space-y-3">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-8">No budgets set yet</p>
                    </div>
                </div>

                <!-- Spending by Category -->
                <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm card-hover">
                    <h3 class="text-lg font-semibold mb-4">💰 Spending by Category</h3>
                    <div class="chart-container">
                        <canvas id="spendingChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analyticsContent" class="tab-content hide">
            <div class="space-y-6">
                <!-- Quick Stats Cards -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-xl text-center border border-purple-200 dark:border-purple-800 card-hover">
                        <div class="text-2xl mb-1">📊</div>
                        <p id="totalTransactionsLabel" class="text-xs text-purple-700 dark:text-purple-300">Total Transactions</p>
                        <p id="totalTransactions" class="text-lg font-bold text-purple-800 dark:text-purple-200">0</p>
                    </div>
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-xl text-center border border-yellow-200 dark:border-yellow-800 card-hover">
                        <div class="text-2xl mb-1">💰</div>
                        <p id="avgDailySpendLabel" class="text-xs text-yellow-700 dark:text-yellow-300">Avg. Daily Spend</p>
                        <p id="avgDailySpend" class="text-lg font-bold text-yellow-800 dark:text-yellow-200">$0</p>
                    </div>
                    <div class="bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-xl text-center border border-indigo-200 dark:border-indigo-800 card-hover">
                        <div class="text-2xl mb-1">📈</div>
                        <p id="highestExpenseLabel" class="text-xs text-indigo-700 dark:text-indigo-300">Highest Expense</p>
                        <p id="highestExpense" class="text-lg font-bold text-indigo-800 dark:text-indigo-200">$0</p>
                    </div>
                    <div class="bg-pink-50 dark:bg-pink-900/20 p-4 rounded-xl text-center border border-pink-200 dark:border-pink-800 card-hover">
                        <div class="text-2xl mb-1">🎯</div>
                        <p id="savingsRateLabel" class="text-xs text-pink-700 dark:text-pink-300">Savings Rate</p>
                        <p id="savingsRate" class="text-lg font-bold text-pink-800 dark:text-pink-200">0%</p>
                    </div>
                </div>

                <!-- Charts -->
                <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm card-hover">
                    <h3 id="monthlyTrendsLabel" class="text-lg font-semibold mb-4">📈 Monthly Trends</h3>
                    <div class="chart-container">
                        <canvas id="trendsChart"></canvas>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm card-hover">
                    <h3 id="categoryBreakdownLabel" class="text-lg font-semibold mb-4">🔄 Category Breakdown</h3>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <!-- Investment Performance -->
                <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm card-hover">
                    <h3 class="text-lg font-semibold mb-4">📊 Investment Performance</h3>
                    <div class="chart-container">
                        <canvas id="investmentChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Tab -->
        <div id="advancedContent" class="tab-content hide">
            <div class="space-y-6">
                <!-- Investment Tracking -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 border border-blue-200 dark:border-blue-800 card-hover">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-blue-800 dark:text-blue-200">📈 Investment Portfolio</h3>
                        <button id="addInvestmentBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Add Investment
                        </button>
                    </div>
                    <div id="investmentsList" class="space-y-3">
                        <p class="text-blue-600 dark:text-blue-400 text-center py-8">No investments tracked yet</p>
                    </div>
                    <div class="mt-4 grid grid-cols-2 gap-4">
                        <div class="text-center">
                            <p class="text-sm text-blue-600 dark:text-blue-400">Total Invested</p>
                            <p id="totalInvested" class="text-xl font-bold text-blue-800 dark:text-blue-200">$0.00</p>
                        </div>
                        <div class="text-center">
                            <p class="text-sm text-blue-600 dark:text-blue-400">Current Value</p>
                            <p id="totalInvestmentValue" class="text-xl font-bold text-blue-800 dark:text-blue-200">$0.00</p>
                        </div>
                    </div>
                </div>

                <!-- Bill Reminders -->
                <div class="bg-gradient-to-r from-orange-50 to-yellow-50 dark:from-orange-900/20 dark:to-yellow-900/20 rounded-xl p-6 border border-orange-200 dark:border-orange-800 card-hover">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-orange-800 dark:text-orange-200">⏰ Bill Reminders</h3>
                        <button id="addBillReminderBtn" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Add Reminder
                        </button>
                    </div>
                    <div id="billRemindersList" class="space-y-3">
                        <p class="text-orange-600 dark:text-orange-400 text-center py-8">No bill reminders set</p>
                    </div>
                </div>

                <!-- Savings Goals -->
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-6 border border-green-200 dark:border-green-800 card-hover">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-green-800 dark:text-green-200">🎯 Savings Goals</h3>
                        <button id="addGoalBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Add Goal
                        </button>
                    </div>
                    <div id="savingsGoalsList" class="space-y-4">
                        <p class="text-green-600 dark:text-green-400 text-center py-8">No savings goals set yet</p>
                    </div>
                </div>

                <!-- Data Management -->
                <div class="bg-gradient-to-r from-gray-50 to-slate-50 dark:from-gray-900/20 dark:to-slate-900/20 rounded-xl p-6 border border-gray-200 dark:border-gray-800 card-hover">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">⚙️ Data Management</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button id="clearAllDataBtn" class="px-4 py-2 bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300 rounded-lg border border-red-300 dark:border-red-700 hover:bg-red-200 dark:hover:bg-red-900/40 transition-colors">
                            <i class="fas fa-trash mr-2"></i>Clear All Data
                        </button>
                        <button id="generateSampleBtn" class="px-4 py-2 bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-lg border border-blue-300 dark:border-blue-700 hover:bg-blue-200 dark:hover:bg-blue-900/40 transition-colors">
                            <i class="fas fa-magic mr-2"></i>Sample Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Calculator Modal -->
    <div id="calculatorModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hide">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-sm w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h2 id="calculatorTitle" class="text-xl font-bold">Calculator</h2>
                <button id="closeCalculator" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mb-4">
                <input type="text" id="calculatorDisplay" class="w-full text-right text-2xl font-mono bg-transparent border-0 focus:outline-none" readonly value="0">
            </div>
            <div class="grid grid-cols-4 gap-2">
                <button class="calculator-btn bg-red-500 text-white p-3 rounded-lg font-semibold" onclick="clearCalculator()">C</button>
                <button class="calculator-btn bg-gray-300 dark:bg-gray-600 p-3 rounded-lg" onclick="deleteDigit()">⌫</button>
                <button class="calculator-btn bg-blue-500 text-white p-3 rounded-lg" onclick="appendToDisplay('/')">/</button>
                <button class="calculator-btn bg-blue-500 text-white p-3 rounded-lg" onclick="appendToDisplay('*')">×</button>
                
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('7')">7</button>
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('8')">8</button>
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('9')">9</button>
                <button class="calculator-btn bg-blue-500 text-white p-3 rounded-lg" onclick="appendToDisplay('-')">-</button>
                
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('4')">4</button>
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('5')">5</button>
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('6')">6</button>
                <button class="calculator-btn bg-blue-500 text-white p-3 rounded-lg" onclick="appendToDisplay('+')">+</button>
                
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('1')">1</button>
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('2')">2</button>
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('3')">3</button>
                <button class="calculator-btn bg-green-500 text-white p-3 rounded-lg row-span-2" onclick="calculate()">=</button>
                
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold col-span-2" onclick="appendToDisplay('0')">0</button>
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg" onclick="appendToDisplay('.')">.</button>
            </div>
        </div>
    </div>

    <!-- Budget Modal -->
    <div id="budgetModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hide">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-sm w-full mx-4 slide-up">
            <h2 id="budgetModalTitle" class="text-xl font-bold mb-4">Set Budget Limit</h2>
            <form id="budgetForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Category</label>
                    <select id="budgetCategory" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Monthly Limit</label>
                    <input type="number" id="budgetLimit" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" placeholder="0.00" required>
                </div>
                <div class="flex space-x-3 pt-2">
                    <button type="button" id="cancelBudgetBtn" class="flex-1 py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">Cancel</button>
                    <button type="submit" id="saveBudgetBtn" class="flex-1 py-2 px-4 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Privacy Policy Modal -->
    <div id="privacyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hide">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h2 id="privacyPolicyTitle" class="text-xl font-bold">Privacy Policy</h2>
                <button id="closePrivacy" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="privacyContent" class="prose dark:prose-invert max-w-none">
                <p>Your privacy is important to us. This application stores data locally on your device and does not share your financial information with third parties.</p>
                <h3>Data Collection</h3>
                <ul>
                    <li>Transaction data is stored locally in your browser</li>
                    <li>No personal information is transmitted to external servers</li>
                    <li>Analytics are computed locally on your device</li>
                </ul>
                <h3>Data Usage</h3>
                <ul>
                    <li>Your data is used solely for providing budget tracking features</li>
                    <li>Financial insights are generated locally</li>
                    <li>No data is sold or shared with advertisers</li>
                </ul>
                <h3>Data Security</h3>
                <p>All data is stored securely in your browser's local storage and is encrypted.</p>
            </div>
        </div>
    </div>

    <!-- Transaction Modal -->
    <div id="transactionModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hide">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-sm w-full mx-4 slide-up">
            <h2 id="modalTitle" class="text-xl font-bold mb-4">Add Transaction</h2>
            <form id="transactionForm" class="space-y-4">
                <div>
                    <label id="typeLabel" class="block text-sm font-medium mb-1">Type</label>
                    <select id="transactionType" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                        <option value="income">Income</option>
                        <option value="expense">Expense</option>
                    </select>
                </div>
                <div>
                    <label id="amountLabel" class="block text-sm font-medium mb-1">Amount</label>
                    <input type="number" id="transactionAmount" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" placeholder="0.00" required>
                </div>
                <div>
                    <label id="categoryLabel" class="block text-sm font-medium mb-1">Category</label>
                    <select id="transactionCategory" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                    </select>
                </div>
                <div>
                    <label id="descriptionLabel" class="block text-sm font-medium mb-1">Description</label>
                    <input type="text" id="transactionDescription" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" placeholder="Enter description">
                </div>
                <div>
                    <label id="dateLabel" class="block text-sm font-medium mb-1">Date</label>
                    <input type="date" id="transactionDate" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                </div>
                <div class="flex space-x-3 pt-2">
                    <button type="button" id="cancelBtn" class="flex-1 py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">Cancel</button>
                    <button type="submit" id="saveBtn" class="flex-1 py-2 px-4 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hide">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-sm w-full mx-4">
            <h3 id="deleteTitle" class="text-lg font-semibold mb-4">Delete Transaction</h3>
            <p id="deleteMessage" class="text-gray-600 dark:text-gray-400 mb-6">Are you sure you want to delete this transaction? This action cannot be undone.</p>
            <div class="flex space-x-3">
                <button id="cancelDeleteBtn" class="flex-1 py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">Cancel</button>
                <button id="confirmDeleteBtn" class="flex-1 py-2 px-4 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">Delete</button>
            </div>
        </div>
    </div>

    <!-- Floating Add Button -->
    <div class="fixed bottom-24 right-4 z-30">
        <button id="floatingAddBtn" class="bg-primary text-white w-14 h-14 rounded-full shadow-xl hover:bg-primary-dark transition-all transform hover:scale-110 flex items-center justify-center">
            <i class="fas fa-plus text-xl"></i>
        </button>
    </div>

    <!-- Footer -->
    <footer class="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-300 dark:border-gray-600 shadow-lg">
        <div class="px-4 py-3">
            <div class="flex justify-between items-center">
                <!-- Quick Actions -->
                <div class="flex space-x-6">
                    <button id="quickAddIncome" class="flex flex-col items-center p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all group">
                        <div class="bg-green-500 p-2 rounded-full group-hover:scale-110 transition-transform">
                            <i class="fas fa-plus text-white text-sm"></i>
                        </div>
                        <span id="incomeText" class="text-xs text-green-600 dark:text-green-400 mt-1">Income</span>
                    </button>
                    <button id="quickAddExpense" class="flex flex-col items-center p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all group">
                        <div class="bg-red-500 p-2 rounded-full group-hover:scale-110 transition-transform">
                            <i class="fas fa-minus text-white text-sm"></i>
                        </div>
                        <span id="expenseText" class="text-xs text-red-600 dark:text-red-400 mt-1">Expense</span>
                    </button>
                </div>

                <!-- Balance Info -->
                <div class="text-center">
                    <p id="footerBalance" class="text-sm font-semibold text-gray-800 dark:text-gray-200">$0.00</p>
                    <p id="netBalanceFooterText" class="text-xs text-gray-500 dark:text-gray-500">Net Balance</p>
                </div>

                <!-- Made by Sagar -->
                <div class="text-right">
                    <p class="text-xs text-gray-600 dark:text-gray-400">Made with ❤️</p>
                    <p class="text-xs font-semibold text-primary">by Sagar</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Dark mode setup
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Enhanced App State
        let transactions = [];
        let recurringTransactions = [];
        let budgetLimits = {};
        let investments = [];
        let billReminders = [];
        let savingsGoals = [];
        let editingTransactionId = null;
        let editingRecurringId = null;
        let editingBudgetCategory = null;
        let charts = {};
        let currentLanguage = 'en';
        let currentCurrency = '$';

        // Enhanced Categories with Emojis
        const categories = {
            income: {
                en: ['💼 Salary', '💻 Freelance', '📈 Investment', '🏢 Business', '🎁 Gift', '💰 Bonus', '🏠 Rental', '📚 Royalty', '🔄 Other'],
                ne: ['💼 तलब', '💻 स्वतन्त्र', '📈 लगानी', '🏢 व्यापार', '🎁 उपहार', '💰 बोनस', '🏠 भाडा', '📚 रोयल्टी', '🔄 अन्य']
            },
            expense: {
                en: ['🍕 Food', '🚗 Transportation', '🎮 Entertainment', '🛍️ Shopping', '💡 Bills', '🏥 Healthcare', '📚 Education', '👕 Clothing', '🏠 Rent', '☕ Coffee', '⛽ Fuel', '📱 Phone', '🔄 Other'],
                ne: ['🍕 खाना', '🚗 यातायात', '🎮 मनोरञ्जन', '🛍️ किनमेल', '💡 बिजुली', '🏥 स्वास्थ्य', '📚 शिक्षा', '👕 लुगा', '🏠 भाडा', '☕ कफी', '⛽ इन्धन', '📱 फोन', '🔄 अन्य']
            }
        };

        // Enhanced Translations
        const translations = {
            en: {
                appTitle: 'Budget Tracker Pro',
                appSubtitle: 'Advanced Money Management',
                dashboard: 'Dashboard',
                transactions: 'Transactions',
                budget: 'Budget',
                analytics: 'Analytics',
                advanced: 'Advanced',
                totalIncome: 'Total Income',
                totalExpenses: 'Total Expenses',
                netBalance: 'Net Balance',
                recentTransactions: 'Recent Transactions',
                noTransactions: 'No transactions yet',
                exportData: 'Export Data',
                importData: 'Import Data',
                backupToCloud: 'Backup to Cloud',
                privacyPolicy: 'Privacy Policy',
                about: 'About',
                calculator: 'Calculator',
                income: 'Income',
                expense: 'Expense',
                type: 'Type',
                amount: 'Amount',
                category: 'Category',
                description: 'Description',
                date: 'Date',
                cancel: 'Cancel',
                save: 'Save',
                delete: 'Delete',
                deleteTransaction: 'Delete Transaction',
                deleteConfirm: 'Are you sure you want to delete this transaction? This action cannot be undone.',
                addTransaction: 'Add Transaction',
                editTransaction: 'Edit Transaction',
                allTypes: 'All Types',
                allCategories: 'All Categories',
                sortByDate: 'Sort by Date',
                sortByAmount: 'Sort by Amount',
                sortByCategory: 'Sort by Category',
                totalTransactions: 'Total Transactions',
                avgDailySpend: 'Avg. Daily Spend',
                highestExpense: 'Highest Expense',
                savingsRate: 'Savings Rate',
                monthlyTrends: 'Monthly Trends',
                categoryBreakdown: 'Category Breakdown',
                searchPlaceholder: 'Search transactions...',
                netBalanceFooter: 'Net Balance',
                recurringTransactions: 'Recurring Transactions',
                addRecurring: 'Add Recurring',
                budgetOverview: 'Budget Overview',
                addBudget: 'Add Budget',
                setBudgetLimit: 'Set Budget Limit',
                monthlyLimit: 'Monthly Limit',
                investmentPortfolio: 'Investment Portfolio',
                addInvestment: 'Add Investment',
                billReminders: 'Bill Reminders',
                addReminder: 'Add Reminder',
                savingsGoals: 'Savings Goals',
                addGoal: 'Add Goal',
                dataManagement: 'Data Management',
                clearAllData: 'Clear All Data',
                generateSample: 'Sample Data'
            },
            ne: {
                appTitle: 'बजेट ट्र्याकर प्रो',
                appSubtitle: 'उन्नत पैसा व्यवस्थापन',
                dashboard: 'ड्यासबोर्ड',
                transactions: 'लेनदेन',
                budget: 'बजेट',
                analytics: 'विश्लेषण',
                advanced: 'उन्नत',
                totalIncome: 'कुल आम्दानी',
                totalExpenses: 'कुल खर्च',
                netBalance: 'शुद्ध बचत',
                recentTransactions: 'हालका लेनदेन',
                noTransactions: 'अहिले सम्म कुनै लेनदेन छैन',
                exportData: 'डाटा निर्यात',
                importData: 'डाटा आयात',
                backupToCloud: 'क्लाउडमा ब्याकअप',
                privacyPolicy: 'गोपनीयता नीति',
                about: 'बारेमा',
                calculator: 'क्यालकुलेटर',
                income: 'आम्दानी',
                expense: 'खर्च',
                type: 'प्रकार',
                amount: 'रकम',
                category: 'श्रेणी',
                description: 'विवरण',
                date: 'मिति',
                cancel: 'रद्द गर्नुहोस्',
                save: 'सेभ गर्नुहोस्',
                delete: 'मेटाउनुहोस्',
                deleteTransaction: 'लेनदेन मेटाउनुहोस्',
                deleteConfirm: 'के तपाईं यो लेनदेन मेटाउन निश्चित हुनुहुन्छ? यो कार्य पूर्ववत गर्न सकिँदैन।',
                addTransaction: 'लेनदेन थप्नुहोस्',
                editTransaction: 'लेनदेन सम्पादन गर्नुहोस्',
                allTypes: 'सबै प्रकार',
                allCategories: 'सबै श्रेणी',
                sortByDate: 'मिति अनुसार क्रमबद्ध',
                sortByAmount: 'रकम अनुसार क्रमबद्ध',
                sortByCategory: 'श्रेणी अनुसार क्रमबद्ध',
                totalTransactions: 'कुल लेनदेन',
                avgDailySpend: 'औसत दैनिक खर्च',
                highestExpense: 'सबैभन्दा ठूलो खर्च',
                savingsRate: 'बचत दर',
                monthlyTrends: 'मासिक प्रवृत्ति',
                categoryBreakdown: 'श्रेणी विभाजन',
                searchPlaceholder: 'लेनदेन खोज्नुहोस्...',
                netBalanceFooter: 'शुद्ध बचत',
                recurringTransactions: 'दोहोरिने लेनदेन',
                addRecurring: 'दोहोरिने थप्नुहोस्',
                budgetOverview: 'बजेट अवलोकन',
                addBudget: 'बजेट थप्नुहोस्',
                setBudgetLimit: 'बजेट सीमा सेट गर्नुहोस्',
                monthlyLimit: 'मासिक सीमा',
                investmentPortfolio: 'लगानी पोर्टफोलियो',
                addInvestment: 'लगानी थप्नुहोस्',
                billReminders: 'बिल रिमाइन्डर',
                addReminder: 'रिमाइन्डर थप्नुहोस्',
                savingsGoals: 'बचत लक्ष्य',
                addGoal: 'लक्ष्य थप्नुहोस्',
                dataManagement: 'डाटा व्यवस्थापन',
                clearAllData: 'सबै डाटा हटाउनुहोस्',
                generateSample: 'नमूना डाटा'
            }
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadData();
            setupEventListeners();
            updateLanguage();
            updateCategoryOptions();
            document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
            updateAll();
            processRecurringTransactions();
            updateSmartInsights();
        }

        function setupEventListeners() {
            // Language switcher
            document.getElementById('languageSelect').addEventListener('change', (e) => {
                currentLanguage = e.target.value;
                currentCurrency = currentLanguage === 'ne' ? 'Rs.' : '$';
                updateLanguage();
                updateAll();
            });

            // Tab navigation
            document.getElementById('dashboardTab').addEventListener('click', () => showTab('dashboard'));
            document.getElementById('transactionsTab').addEventListener('click', () => showTab('transactions'));
            document.getElementById('budgetTab').addEventListener('click', () => showTab('budget'));
            document.getElementById('analyticsTab').addEventListener('click', () => showTab('analytics'));
            document.getElementById('advancedTab').addEventListener('click', () => showTab('advanced'));

            // Header buttons
            document.getElementById('floatingAddBtn').addEventListener('click', openAddModal);
            document.getElementById('searchBtn').addEventListener('click', toggleSearch);
            document.getElementById('menuBtn').addEventListener('click', toggleMenu);
            document.getElementById('calculatorBtn').addEventListener('click', openCalculator);
            document.getElementById('searchInput').addEventListener('input', handleSearch);

            // Menu dropdown
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('importBtn').addEventListener('click', importData);
            document.getElementById('backupBtn').addEventListener('click', backupToCloud);
            document.getElementById('privacyBtn').addEventListener('click', openPrivacyModal);
            document.getElementById('aboutBtn').addEventListener('click', showAbout);

            // Footer quick actions
            document.getElementById('quickAddIncome').addEventListener('click', () => openQuickAddModal('income'));
            document.getElementById('quickAddExpense').addEventListener('click', () => openQuickAddModal('expense'));

            // Modal controls
            document.getElementById('cancelBtn').addEventListener('click', closeModal);
            document.getElementById('transactionForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('transactionType').addEventListener('change', updateCategoryOptions);

            // Budget controls
            document.getElementById('addBudgetBtn').addEventListener('click', openBudgetModal);
            document.getElementById('cancelBudgetBtn').addEventListener('click', closeBudgetModal);
            document.getElementById('budgetForm').addEventListener('submit', handleBudgetSubmit);

            // Advanced tab buttons
            document.getElementById('addInvestmentBtn').addEventListener('click', addInvestment);
            document.getElementById('addBillReminderBtn').addEventListener('click', addBillReminder);
            document.getElementById('addGoalBtn').addEventListener('click', addSavingsGoal);
            document.getElementById('clearAllDataBtn').addEventListener('click', clearAllData);
            document.getElementById('generateSampleBtn').addEventListener('click', generateSampleData);

            // Recurring transactions
            document.getElementById('recurringTransactionsBtn').addEventListener('click', showRecurringTransactions);
            document.getElementById('addRecurringBtn').addEventListener('click', addRecurringTransaction);

            // Calculator
            document.getElementById('closeCalculator').addEventListener('click', closeCalculator);

            // Privacy modal
            document.getElementById('closePrivacy').addEventListener('click', closePrivacyModal);

            // Filter and sort controls
            document.getElementById('filterType').addEventListener('change', updateTransactionsList);
            document.getElementById('filterCategory').addEventListener('change', updateTransactionsList);
            document.getElementById('sortBy').addEventListener('change', updateTransactionsList);
            document.getElementById('dateRangeFilter').addEventListener('change', updateTransactionsList);

            // Delete modal
            document.getElementById('cancelDeleteBtn').addEventListener('click', closeDeleteModal);
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);

            // Close modals on background click
            document.addEventListener('click', (e) => {
                if (e.target === document.getElementById('transactionModal')) closeModal();
                if (e.target === document.getElementById('deleteModal')) closeDeleteModal();
                if (e.target === document.getElementById('calculatorModal')) closeCalculator();
                if (e.target === document.getElementById('privacyModal')) closePrivacyModal();
                if (e.target === document.getElementById('budgetModal')) closeBudgetModal();
                if (!e.target.closest('#menuDropdown') && !e.target.closest('#menuBtn')) {
                    document.getElementById('menuDropdown').classList.add('hide');
                }
            });

            // Auto-save data when changes are made
            window.addEventListener('beforeunload', saveData);
        }

        // Data Management Functions
        function saveData() {
            try {
                const data = {
                    transactions,
                    recurringTransactions,
                    budgetLimits,
                    investments,
                    billReminders,
                    savingsGoals,
                    currentLanguage,
                    currentCurrency
                };
                localStorage.setItem('budgetTrackerPro', JSON.stringify(data));
            } catch (error) {
                console.error('Failed to save data:', error);
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('budgetTrackerPro');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    transactions = data.transactions || [];
                    recurringTransactions = data.recurringTransactions || [];
                    budgetLimits = data.budgetLimits || {};
                    investments = data.investments || [];
                    billReminders = data.billReminders || [];
                    savingsGoals = data.savingsGoals || [];
                    currentLanguage = data.currentLanguage || 'en';
                    currentCurrency = data.currentCurrency || '$';
                    
                    document.getElementById('languageSelect').value = currentLanguage;
                }
            } catch (error) {
                console.error('Failed to load data:', error);
            }
        }

        function clearAllData() {
            showConfirmDialog('Are you sure you want to clear all data? This action cannot be undone.', () => {
                transactions = [];
                recurringTransactions = [];
                budgetLimits = {};
                investments = [];
                billReminders = [];
                savingsGoals = [];
                saveData();
                updateAll();
                showNotification('All data cleared successfully!', 'success');
            });
        }

        function generateSampleData() {
            const sampleTransactions = [
                { id: Date.now() + 1, type: 'income', amount: 5000, category: '💼 Salary', description: 'Monthly salary', date: '2024-01-01', timestamp: new Date() },
                { id: Date.now() + 2, type: 'expense', amount: 800, category: '🏠 Rent', description: 'Monthly rent', date: '2024-01-01', timestamp: new Date() },
                { id: Date.now() + 3, type: 'expense', amount: 150, category: '🍕 Food', description: 'Groceries', date: '2024-01-02', timestamp: new Date() },
                { id: Date.now() + 4, type: 'expense', amount: 50, category: '⛽ Fuel', description: 'Gas station', date: '2024-01-03', timestamp: new Date() },
                { id: Date.now() + 5, type: 'income', amount: 500, category: '💻 Freelance', description: 'Web design project', date: '2024-01-05', timestamp: new Date() }
            ];

            const sampleBudgets = {
                '🍕 Food': 500,
                '🚗 Transportation': 300,
                '🎮 Entertainment': 200,
                '🛍️ Shopping': 250
            };

            transactions.push(...sampleTransactions);
            budgetLimits = { ...budgetLimits, ...sampleBudgets };
            
            saveData();
            updateAll();
            showNotification('Sample data generated successfully!', 'success');
        }

        // Advanced Features Implementation
        function calculateFinancialHealthScore() {
            if (transactions.length === 0) return 50;

            const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            
            let score = 50; // Base score

            // Savings rate (40% of score)
            const savingsRate = income > 0 ? ((income - expenses) / income) * 100 : 0;
            score += (savingsRate * 0.4);

            // Transaction consistency (20% of score)
            const recentTransactions = transactions.filter(t => {
                const transactionDate = new Date(t.date);
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                return transactionDate >= thirtyDaysAgo;
            });
            
            if (recentTransactions.length > 0) {
                score += 20;
            }

            // Budget compliance (20% of score)
            const budgetCompliance = calculateBudgetCompliance();
            score += (budgetCompliance * 0.2);

            // Diversification (20% of score)
            const categories = [...new Set(transactions.map(t => t.category))];
            const diversificationScore = Math.min(categories.length * 5, 20);
            score += diversificationScore;

            return Math.max(0, Math.min(100, Math.round(score)));
        }

        function calculateBudgetCompliance() {
            const currentMonth = new Date().toISOString().substring(0, 7);
            const monthlyExpenses = {};

            transactions.filter(t => t.type === 'expense' && t.date.startsWith(currentMonth))
                .forEach(t => {
                    monthlyExpenses[t.category] = (monthlyExpenses[t.category] || 0) + t.amount;
                });

            let totalCompliance = 0;
            let budgetCount = 0;

            Object.keys(budgetLimits).forEach(category => {
                const spent = monthlyExpenses[category] || 0;
                const limit = budgetLimits[category];
                const compliance = Math.max(0, 100 - ((spent / limit) * 100));
                totalCompliance += compliance;
                budgetCount++;
            });

            return budgetCount > 0 ? totalCompliance / budgetCount : 100;
        }

        function updateSmartInsights() {
            const insights = generateSmartInsights();
            const insightsContainer = document.getElementById('smartInsights');
            const insightText = document.getElementById('insightText');

            if (insights.length > 0) {
                insightText.textContent = insights[0];
                insightsContainer.classList.remove('hide');
            } else {
                insightsContainer.classList.add('hide');
            }
        }

        function generateSmartInsights() {
            const insights = [];
            const currentMonth = new Date().toISOString().substring(0, 7);
            
            // Check budget overruns
            const monthlyExpenses = {};
            transactions.filter(t => t.type === 'expense' && t.date.startsWith(currentMonth))
                .forEach(t => {
                    monthlyExpenses[t.category] = (monthlyExpenses[t.category] || 0) + t.amount;
                });

            Object.keys(budgetLimits).forEach(category => {
                const spent = monthlyExpenses[category] || 0;
                const limit = budgetLimits[category];
                const percentage = (spent / limit) * 100;

                if (percentage > 90) {
                    insights.push(`⚠️ You've spent ${percentage.toFixed(0)}% of your ${category} budget this month`);
                }
            });

            // Check spending patterns
            const lastWeekExpenses = transactions.filter(t => {
                const transactionDate = new Date(t.date);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return t.type === 'expense' && transactionDate >= weekAgo;
            }).reduce((sum, t) => sum + t.amount, 0);

            const previousWeekExpenses = transactions.filter(t => {
                const transactionDate = new Date(t.date);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                const twoWeeksAgo = new Date();
                twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
                return t.type === 'expense' && transactionDate >= twoWeeksAgo && transactionDate < weekAgo;
            }).reduce((sum, t) => sum + t.amount, 0);

            if (previousWeekExpenses > 0) {
                const changePercentage = ((lastWeekExpenses - previousWeekExpenses) / previousWeekExpenses) * 100;
                if (changePercentage > 25) {
                    insights.push(`📈 Your spending increased by ${changePercentage.toFixed(0)}% this week`);
                } else if (changePercentage < -25) {
                    insights.push(`💰 Great job! Your spending decreased by ${Math.abs(changePercentage).toFixed(0)}% this week`);
                }
            }

            return insights;
        }

        function processRecurringTransactions() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];

            recurringTransactions.forEach(recurring => {
                const lastProcessed = new Date(recurring.lastProcessed || recurring.startDate);
                const daysDiff = Math.floor((today - lastProcessed) / (1000 * 60 * 60 * 24));

                let shouldProcess = false;
                switch (recurring.frequency) {
                    case 'daily':
                        shouldProcess = daysDiff >= 1;
                        break;
                    case 'weekly':
                        shouldProcess = daysDiff >= 7;
                        break;
                    case 'monthly':
                        shouldProcess = daysDiff >= 30;
                        break;
                    case 'yearly':
                        shouldProcess = daysDiff >= 365;
                        break;
                }

                if (shouldProcess) {
                    const transaction = {
                        id: Date.now() + Math.random(),
                        type: recurring.type,
                        amount: recurring.amount,
                        category: recurring.category,
                        description: `${recurring.description} (Auto)`,
                        date: todayStr,
                        timestamp: new Date(),
                        isRecurring: true
                    };
                    
                    transactions.push(transaction);
                    recurring.lastProcessed = todayStr;
                    saveData();
                }
            });
        }

        function updateAll() {
            updateDashboard();
            updateTransactionsList();
            updateBudgetOverview();
            updateAnalytics();
            updateAnalyticsStats();
            updateFooterBalance();
            updateFinancialHealthScore();
            updateBillReminders();
            updateBudgetAlerts();
            updateSmartInsights();
            saveData();
        }

        function updateFinancialHealthScore() {
            const score = calculateFinancialHealthScore();
            document.getElementById('healthScore').textContent = score;
            document.getElementById('healthScoreDisplay').textContent = score;
            document.getElementById('healthScoreBar').style.width = `${score}%`;
            
            let healthText = 'Poor';
            if (score >= 80) healthText = 'Excellent';
            else if (score >= 60) healthText = 'Good';
            else if (score >= 40) healthText = 'Fair';
            
            document.getElementById('healthScoreText').textContent = healthText;
        }

        function updateBudgetAlerts() {
            const alertsContainer = document.getElementById('budgetAlertsSection');
            const currentMonth = new Date().toISOString().substring(0, 7);
            const monthlyExpenses = {};

            transactions.filter(t => t.type === 'expense' && t.date.startsWith(currentMonth))
                .forEach(t => {
                    monthlyExpenses[t.category] = (monthlyExpenses[t.category] || 0) + t.amount;
                });

            const alerts = [];
            Object.keys(budgetLimits).forEach(category => {
                const spent = monthlyExpenses[category] || 0;
                const limit = budgetLimits[category];
                const percentage = (spent / limit) * 100;

                if (percentage > 100) {
                    alerts.push({
                        category,
                        percentage,
                        type: 'danger',
                        message: `${category} budget exceeded by ${formatCurrency(spent - limit)}`
                    });
                } else if (percentage > 80) {
                    alerts.push({
                        category,
                        percentage,
                        type: 'warning',
                        message: `${category} budget is ${percentage.toFixed(0)}% used`
                    });
                }
            });

            if (alerts.length > 0) {
                alertsContainer.innerHTML = alerts.map(alert => `
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl border-l-4 ${alert.type === 'danger' ? 'border-red-500' : 'border-yellow-500'} card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-medium ${alert.type === 'danger' ? 'text-red-600' : 'text-yellow-600'}">${alert.message}</p>
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-2">
                                    <div class="${alert.type === 'danger' ? 'bg-red-500' : 'bg-yellow-500'} h-2 rounded-full transition-all duration-300" style="width: ${Math.min(alert.percentage, 100)}%"></div>
                                </div>
                            </div>
                            <div class="text-2xl">${alert.type === 'danger' ? '🚨' : '⚠️'}</div>
                        </div>
                    </div>
                `).join('');
                alertsContainer.classList.remove('hide');
            } else {
                alertsContainer.classList.add('hide');
            }
        }

        // Fixed chart functions to prevent scroll issues
        function formatCurrency(amount) {
            return currentLanguage === 'ne' ? `Rs.${amount.toFixed(2)}` : `$${amount.toFixed(2)}`;
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');

            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hide'));
            document.getElementById(tabName + 'Content').classList.remove('hide');

            if (tabName === 'analytics') {
                setTimeout(updateAnalytics, 100);
            } else if (tabName === 'budget') {
                setTimeout(updateBudgetOverview, 100);
            }
        }

        function updateLanguage() {
            const t = translations[currentLanguage];
            
            // Update UI text
            document.getElementById('appTitle').textContent = t.appTitle;
            document.getElementById('appSubtitle').textContent = t.appSubtitle;
            document.getElementById('dashboardTabText').textContent = t.dashboard;
            document.getElementById('transactionsTabText').textContent = t.transactions;
            document.getElementById('budgetTabText').textContent = t.budget;
            document.getElementById('analyticsTabText').textContent = t.analytics;
            document.getElementById('advancedTabText').textContent = t.advanced;
            
            // Update all other UI elements
            updateSelectOptions();
        }

        function updateSelectOptions() {
            const t = translations[currentLanguage];
            
            // Update transaction type options
            const typeSelect = document.getElementById('transactionType');
            typeSelect.innerHTML = `
                <option value="income">${t.income}</option>
                <option value="expense">${t.expense}</option>
            `;
            
            // Update filter type options
            const filterType = document.getElementById('filterType');
            filterType.innerHTML = `
                <option value="">${t.allTypes}</option>
                <option value="income">${t.income}</option>
                <option value="expense">${t.expense}</option>
            `;
            
            updateCategoryOptions();
        }

        function updateCategoryOptions() {
            const type = document.getElementById('transactionType').value;
            const categorySelect = document.getElementById('transactionCategory');
            const filterCategorySelect = document.getElementById('filterCategory');
            const budgetCategorySelect = document.getElementById('budgetCategory');
            
            // Update transaction category
            categorySelect.innerHTML = '';
            categories[type][currentLanguage].forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });

            // Update filter categories
            const t = translations[currentLanguage];
            filterCategorySelect.innerHTML = `<option value="">${t.allCategories}</option>`;
            Object.values(categories).forEach(typeCategories => {
                typeCategories[currentLanguage].forEach(category => {
                    if (!filterCategorySelect.querySelector(`option[value="${category}"]`)) {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        filterCategorySelect.appendChild(option);
                    }
                });
            });

            // Update budget categories (only expense categories)
            if (budgetCategorySelect) {
                budgetCategorySelect.innerHTML = '';
                categories.expense[currentLanguage].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    budgetCategorySelect.appendChild(option);
                });
            }
        }

        // Fixed spending chart function to prevent auto-scroll
        function updateSpendingChart() {
            const ctx = document.getElementById('spendingChart');
            if (!ctx) return;

            // Prevent auto-scroll by saving scroll position
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

            if (charts.spending) {
                charts.spending.destroy();
            }

            const currentMonth = new Date().toISOString().substring(0, 7);
            const categoryData = {};
            
            transactions.filter(t => t.type === 'expense' && t.date.startsWith(currentMonth))
                .forEach(t => {
                    categoryData[t.category] = (categoryData[t.category] || 0) + t.amount;
                });

            const labels = Object.keys(categoryData);
            const spentData = Object.values(categoryData);
            const budgetData = labels.map(category => budgetLimits[category] || 0);

            // Only create chart if there's data
            if (labels.length === 0) {
                const container = ctx.closest('.chart-container');
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No spending data for this month</p>';
                return;
            }

            charts.spending = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Spent',
                        data: spentData,
                        backgroundColor: 'rgba(239, 68, 68, 0.8)'
                    }, {
                        label: 'Budget',
                        data: budgetData,
                        backgroundColor: 'rgba(16, 185, 129, 0.8)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 0 // Disable animation to prevent scroll issues
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#fff' : '#000'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            },
                            grid: { color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB' }
                        },
                        x: {
                            ticks: { 
                                color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                                maxRotation: 45,
                                minRotation: 0
                            },
                            grid: { color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB' }
                        }
                    }
                }
            });

            // Restore scroll position to prevent auto-scroll
            setTimeout(() => {
                window.scrollTo(0, scrollTop);
            }, 10);
        }

        // Budget Management Functions
        function openBudgetModal() {
            updateCategoryOptions();
            document.getElementById('budgetModal').classList.remove('hide');
        }

        function closeBudgetModal() {
            document.getElementById('budgetModal').classList.add('hide');
            editingBudgetCategory = null;
        }

        function handleBudgetSubmit(e) {
            e.preventDefault();
            
            const category = document.getElementById('budgetCategory').value;
            const limit = parseFloat(document.getElementById('budgetLimit').value);
            
            budgetLimits[category] = limit;
            closeBudgetModal();
            updateBudgetOverview();
            showNotification('Budget limit set successfully!', 'success');
        }

        function updateBudgetOverview() {
            const budgetList = document.getElementById('budgetList');
            const currentMonth = new Date().toISOString().substring(0, 7);
            
            const monthlyExpenses = {};
            transactions.filter(t => t.type === 'expense' && t.date.startsWith(currentMonth))
                .forEach(t => {
                    monthlyExpenses[t.category] = (monthlyExpenses[t.category] || 0) + t.amount;
                });

            if (Object.keys(budgetLimits).length === 0) {
                budgetList.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No budgets set yet</p>';
                return;
            }

            budgetList.innerHTML = Object.keys(budgetLimits).map(category => {
                const limit = budgetLimits[category];
                const spent = monthlyExpenses[category] || 0;
                const percentage = (spent / limit) * 100;
                const remaining = limit - spent;

                return `
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-medium">${category}</h4>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm ${percentage > 100 ? 'text-red-600' : percentage > 80 ? 'text-yellow-600' : 'text-green-600'}">
                                    ${formatCurrency(spent)} / ${formatCurrency(limit)}
                                </span>
                                <button onclick="deleteBudget('${category}')" class="text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash text-xs"></i>
                                </button>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                            <div class="${percentage > 100 ? 'bg-red-500' : percentage > 80 ? 'bg-yellow-500' : 'bg-green-500'} h-3 rounded-full transition-all duration-300" style="width: ${Math.min(percentage, 100)}%"></div>
                        </div>
                        <div class="flex justify-between text-xs mt-1">
                            <span class="${remaining >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${remaining >= 0 ? 'Remaining' : 'Over budget'}: ${formatCurrency(Math.abs(remaining))}
                            </span>
                            <span class="text-gray-500">${percentage.toFixed(1)}%</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteBudget(category) {
            showConfirmDialog(`Delete budget for ${category}?`, () => {
                delete budgetLimits[category];
                updateBudgetOverview();
                showNotification('Budget deleted successfully!', 'success');
            });
        }

        // Enhanced transaction functions with all the existing functionality...
        function openAddModal() {
            editingTransactionId = null;
            const t = translations[currentLanguage];
            document.getElementById('modalTitle').textContent = t.addTransaction;
            document.getElementById('transactionForm').reset();
            document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
            updateCategoryOptions();
            document.getElementById('transactionModal').classList.remove('hide');
        }

        function openEditModal(transaction) {
            editingTransactionId = transaction.id;
            const t = translations[currentLanguage];
            document.getElementById('modalTitle').textContent = t.editTransaction;
            document.getElementById('transactionType').value = transaction.type;
            document.getElementById('transactionAmount').value = transaction.amount;
            document.getElementById('transactionDescription').value = transaction.description;
            document.getElementById('transactionDate').value = transaction.date;
            updateCategoryOptions();
            document.getElementById('transactionCategory').value = transaction.category;
            document.getElementById('transactionModal').classList.remove('hide');
        }

        function closeModal() {
            document.getElementById('transactionModal').classList.add('hide');
            editingTransactionId = null;
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            
            const formData = {
                type: document.getElementById('transactionType').value,
                amount: parseFloat(document.getElementById('transactionAmount').value),
                category: document.getElementById('transactionCategory').value,
                description: document.getElementById('transactionDescription').value,
                date: document.getElementById('transactionDate').value
            };

            if (editingTransactionId) {
                updateTransaction(editingTransactionId, formData);
            } else {
                addTransaction(formData);
            }

            closeModal();
        }

        function addTransaction(data) {
            const transaction = {
                id: Date.now(),
                ...data,
                timestamp: new Date()
            };
            transactions.push(transaction);
            updateAll();
            showNotification(translations[currentLanguage].income === data.type ? 'Income added!' : 'Expense added!', 'success');
        }

        function updateTransaction(id, data) {
            const index = transactions.findIndex(t => t.id === id);
            if (index !== -1) {
                transactions[index] = { ...transactions[index], ...data };
                updateAll();
                showNotification('Transaction updated!', 'success');
            }
        }

        function deleteTransaction(id) {
            transactions = transactions.filter(t => t.id !== id);
            updateAll();
            showNotification('Transaction deleted!', 'success');
        }

        function openDeleteModal(transactionId) {
            document.getElementById('deleteModal').classList.remove('hide');
            document.getElementById('confirmDeleteBtn').onclick = () => {
                deleteTransaction(transactionId);
                closeDeleteModal();
            };
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hide');
        }

        function confirmDelete() {
            closeDeleteModal();
        }

        function updateDashboard() {
            const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expenses;

            document.getElementById('totalIncome').textContent = formatCurrency(income);
            document.getElementById('totalExpenses').textContent = formatCurrency(expenses);
            document.getElementById('netBalance').textContent = formatCurrency(balance);

            // Calculate month-over-month changes
            const lastMonth = new Date();
            lastMonth.setMonth(lastMonth.getMonth() - 1);
            const lastMonthStr = lastMonth.toISOString().substring(0, 7);
            
            const lastMonthIncome = transactions.filter(t => t.type === 'income' && t.date.startsWith(lastMonthStr)).reduce((sum, t) => sum + t.amount, 0);
            const lastMonthExpenses = transactions.filter(t => t.type === 'expense' && t.date.startsWith(lastMonthStr)).reduce((sum, t) => sum + t.amount, 0);
            
            const incomeChange = lastMonthIncome > 0 ? ((income - lastMonthIncome) / lastMonthIncome * 100) : 0;
            const expenseChange = lastMonthExpenses > 0 ? ((expenses - lastMonthExpenses) / lastMonthExpenses * 100) : 0;
            const balanceChange = income + expenses > 0 ? ((balance - (lastMonthIncome - lastMonthExpenses)) / (lastMonthIncome - lastMonthExpenses) * 100) : 0;

            document.getElementById('incomeChange').textContent = `${incomeChange >= 0 ? '+' : ''}${incomeChange.toFixed(1)}% from last month`;
            document.getElementById('expenseChange').textContent = `${expenseChange >= 0 ? '+' : ''}${expenseChange.toFixed(1)}% from last month`;
            document.getElementById('balanceChange').textContent = `${balanceChange >= 0 ? '+' : ''}${balanceChange.toFixed(1)}% from last month`;

            const recent = transactions
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);

            const recentContainer = document.getElementById('recentTransactions');
            if (recent.length === 0) {
                recentContainer.innerHTML = `<p class="text-gray-500 dark:text-gray-400 text-center py-8">${translations[currentLanguage].noTransactions}</p>`;
            } else {
                recentContainer.innerHTML = recent.map(transaction => `
                    <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg transition-all hover:bg-gray-100 dark:hover:bg-gray-600">
                        <div>
                            <p class="font-medium">${transaction.description || transaction.category}</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">${transaction.date} • ${transaction.category}</p>
                        </div>
                        <span class="font-bold ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                            ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount).replace(currentCurrency, '')}
                        </span>
                    </div>
                `).join('');
            }
        }

        function getFilteredTransactions() {
            const typeFilter = document.getElementById('filterType').value;
            const categoryFilter = document.getElementById('filterCategory').value;
            const dateRange = document.getElementById('dateRangeFilter').value;
            const sortBy = document.getElementById('sortBy').value;

            let filtered = [...transactions];

            // Apply filters
            if (typeFilter) {
                filtered = filtered.filter(t => t.type === typeFilter);
            }
            if (categoryFilter) {
                filtered = filtered.filter(t => t.category === categoryFilter);
            }

            // Apply date range filter
            if (dateRange !== 'all') {
                const now = new Date();
                let startDate;

                switch (dateRange) {
                    case 'week':
                        startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        break;
                    case 'month':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        break;
                    case 'quarter':
                        startDate = new Date(now.getFullYear(), Math.floor(now.getMonth() / 3) * 3, 1);
                        break;
                    case 'year':
                        startDate = new Date(now.getFullYear(), 0, 1);
                        break;
                }

                if (startDate) {
                    filtered = filtered.filter(t => new Date(t.date) >= startDate);
                }
            }

            // Apply sorting
            switch (sortBy) {
                case 'amount':
                    filtered.sort((a, b) => b.amount - a.amount);
                    break;
                case 'category':
                    filtered.sort((a, b) => a.category.localeCompare(b.category));
                    break;
                default:
                    filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
            }

            return filtered;
        }

        function updateTransactionsList() {
            const filtered = getFilteredTransactions();
            const container = document.getElementById('transactionsList');
            
            if (filtered.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No transactions found</p>';
            } else {
                container.innerHTML = filtered.map(transaction => `
                    <div class="transaction-item bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 card-hover">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-medium">${transaction.description || transaction.category}</h4>
                                <p class="text-sm text-gray-500 dark:text-gray-400">${transaction.date} • ${transaction.category}</p>
                                ${transaction.isRecurring ? '<span class="text-xs bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-300 px-2 py-1 rounded">Recurring</span>' : ''}
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="font-bold ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                                    ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount)}
                                </span>
                                <div class="flex space-x-1">
                                    <button onclick="openEditModal(${JSON.stringify(transaction).replace(/"/g, '&quot;')})" class="p-1 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="openDeleteModal(${transaction.id})" class="p-1 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateAnalytics() {
            updateTrendsChart();
            updateCategoryChart();
            updateSpendingChart();
            updateInvestmentChart();
        }

        function updateTrendsChart() {
            const ctx = document.getElementById('trendsChart').getContext('2d');
            
            if (charts.trends) {
                charts.trends.destroy();
            }

            const monthlyData = {};
            const filtered = getFilteredTransactions();
            
            filtered.forEach(t => {
                const month = t.date.substring(0, 7);
                if (!monthlyData[month]) {
                    monthlyData[month] = { income: 0, expenses: 0 };
                }
                monthlyData[month][t.type === 'income' ? 'income' : 'expenses'] += t.amount;
            });

            const months = Object.keys(monthlyData).sort();
            const incomeData = months.map(m => monthlyData[m].income);
            const expenseData = months.map(m => monthlyData[m].expenses);

            const t = translations[currentLanguage];
            charts.trends = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: t.income,
                        data: incomeData,
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: t.expense,
                        data: expenseData,
                        borderColor: '#EF4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 0 },
                    plugins: {
                        legend: {
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#fff' : '#000'
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: { color: document.documentElement.classList.contains('dark') ? '#fff' : '#000' },
                            grid: { color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB' }
                        },
                        x: {
                            ticks: { color: document.documentElement.classList.contains('dark') ? '#fff' : '#000' },
                            grid: { color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB' }
                        }
                    }
                }
            });
        }

        function updateCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            
            if (charts.category) {
                charts.category.destroy();
            }

            const categoryData = {};
            const filtered = getFilteredTransactions().filter(t => t.type === 'expense');
            
            filtered.forEach(t => {
                categoryData[t.category] = (categoryData[t.category] || 0) + t.amount;
            });

            const labels = Object.keys(categoryData);
            const data = Object.values(categoryData);

            charts.category = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#EF4444', '#F97316', '#F59E0B', '#EAB308',
                            '#84CC16', '#22C55E', '#10B981', '#14B8A6',
                            '#06B6D4', '#0EA5E9', '#3B82F6', '#6366F1',
                            '#8B5CF6', '#A855F7', '#C026D3', '#DB2777'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 0 },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                                padding: 15,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function updateInvestmentChart() {
            const ctx = document.getElementById('investmentChart');
            if (!ctx || investments.length === 0) return;

            if (charts.investment) {
                charts.investment.destroy();
            }

            const labels = investments.map(inv => inv.name);
            const investedData = investments.map(inv => inv.amount);
            const currentData = investments.map(inv => inv.currentValue);

            charts.investment = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Invested',
                        data: investedData,
                        backgroundColor: 'rgba(59, 130, 246, 0.8)'
                    }, {
                        label: 'Current Value',
                        data: currentData,
                        backgroundColor: 'rgba(16, 185, 129, 0.8)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 0 },
                    plugins: {
                        legend: {
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#fff' : '#000'
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: { color: document.documentElement.classList.contains('dark') ? '#fff' : '#000' },
                            grid: { color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB' }
                        },
                        x: {
                            ticks: { color: document.documentElement.classList.contains('dark') ? '#fff' : '#000' },
                            grid: { color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB' }
                        }
                    }
                }
            });
        }

        function updateAnalyticsStats() {
            const filtered = getFilteredTransactions();
            document.getElementById('totalTransactions').textContent = filtered.length;
            
            const expenses = filtered.filter(t => t.type === 'expense');
            const avgDaily = expenses.length > 0 ? 
                expenses.reduce((sum, t) => sum + t.amount, 0) / expenses.length : 0;
            document.getElementById('avgDailySpend').textContent = formatCurrency(avgDaily).replace('.00', '');
            
            const highestExpense = expenses.length > 0 ? 
                Math.max(...expenses.map(t => t.amount)) : 0;
            document.getElementById('highestExpense').textContent = formatCurrency(highestExpense).replace('.00', '');
            
            const income = filtered.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpenses = expenses.reduce((sum, t) => sum + t.amount, 0);
            const savingsRate = income > 0 ? ((income - totalExpenses) / income * 100) : 0;
            document.getElementById('savingsRate').textContent = `${Math.max(0, savingsRate).toFixed(1)}%`;
        }

        function updateBillReminders() {
            const container = document.getElementById('upcomingBills');
            const section = document.getElementById('billRemindersSection');
            
            if (!container || billReminders.length === 0) {
                if (section) section.classList.add('hide');
                return;
            }

            const today = new Date();
            const upcoming = billReminders.filter(bill => {
                const dueDate = new Date(bill.dueDate);
                const daysDiff = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                return daysDiff >= 0 && daysDiff <= 7;
            });

            if (upcoming.length === 0) {
                section.classList.add('hide');
                return;
            }

            section.classList.remove('hide');
            container.innerHTML = upcoming.map(bill => {
                const dueDate = new Date(bill.dueDate);
                const daysDiff = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                
                return `
                    <div class="flex justify-between items-center p-3 bg-orange-100 dark:bg-orange-900/20 rounded-lg">
                        <div>
                            <p class="font-medium">${bill.name}</p>
                            <p class="text-sm text-orange-600 dark:text-orange-400">Due ${daysDiff === 0 ? 'today' : `in ${daysDiff} day${daysDiff > 1 ? 's' : ''}`}</p>
                        </div>
                        <span class="font-bold text-orange-700 dark:text-orange-300">${formatCurrency(bill.amount)}</span>
                    </div>
                `;
            }).join('');
        }

        function updateFooterBalance() {
            const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expenses;
            document.getElementById('footerBalance').textContent = formatCurrency(balance);
        }

        // Advanced Feature Functions
        function addInvestment() {
            showPromptDialog('Investment Name:', 'Stocks', (name) => {
                if (!name) return;
                showPromptDialog('Initial Investment Amount:', '', (amount) => {
                    if (!amount) return;
                    showPromptDialog('Current Value:', amount, (currentValue) => {
                        if (!currentValue) return;
                        
                        const investment = {
                            id: Date.now(),
                            name,
                            amount: parseFloat(amount),
                            currentValue: parseFloat(currentValue),
                            date: new Date().toISOString().split('T')[0]
                        };
                        
                        investments.push(investment);
                        updateInvestmentsList();
                        updateAll();
                        showNotification('Investment added successfully!', 'success');
                    });
                });
            });
        }

        function updateInvestmentsList() {
            const container = document.getElementById('investmentsList');
            const totalInvestedEl = document.getElementById('totalInvested');
            const totalValueEl = document.getElementById('totalInvestmentValue');
            
            if (investments.length === 0) {
                container.innerHTML = '<p class="text-blue-600 dark:text-blue-400 text-center py-8">No investments tracked yet</p>';
                totalInvestedEl.textContent = formatCurrency(0);
                totalValueEl.textContent = formatCurrency(0);
                return;
            }

            const totalInvested = investments.reduce((sum, inv) => sum + inv.amount, 0);
            const totalValue = investments.reduce((sum, inv) => sum + inv.currentValue, 0);
            
            totalInvestedEl.textContent = formatCurrency(totalInvested);
            totalValueEl.textContent = formatCurrency(totalValue);

            container.innerHTML = investments.map(investment => {
                const gain = investment.currentValue - investment.amount;
                const gainPercentage = (gain / investment.amount) * 100;
                
                return `
                    <div class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-medium">${investment.name}</h4>
                                <p class="text-sm text-blue-600 dark:text-blue-400">${formatCurrency(investment.amount)} → ${formatCurrency(investment.currentValue)}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-bold ${gain >= 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${gain >= 0 ? '+' : ''}${formatCurrency(gain)}
                                </p>
                                <p class="text-xs ${gain >= 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${gainPercentage >= 0 ? '+' : ''}${gainPercentage.toFixed(1)}%
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function addBillReminder() {
            showPromptDialog('Bill Name:', 'Electric Bill', (name) => {
                if (!name) return;
                showPromptDialog('Amount:', '', (amount) => {
                    if (!amount) return;
                    showPromptDialog('Due Date (YYYY-MM-DD):', '', (dueDate) => {
                        if (!dueDate) return;
                        
                        const reminder = {
                            id: Date.now(),
                            name,
                            amount: parseFloat(amount),
                            dueDate,
                            recurring: true
                        };
                        
                        billReminders.push(reminder);
                        updateBillRemindersList();
                        updateAll();
                        showNotification('Bill reminder added successfully!', 'success');
                    });
                });
            });
        }

        function updateBillRemindersList() {
            const container = document.getElementById('billRemindersList');
            
            if (billReminders.length === 0) {
                container.innerHTML = '<p class="text-orange-600 dark:text-orange-400 text-center py-8">No bill reminders set</p>';
                return;
            }

            container.innerHTML = billReminders.map(reminder => `
                <div class="bg-orange-50 dark:bg-orange-900/20 p-3 rounded-lg">
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-medium">${reminder.name}</h4>
                            <p class="text-sm text-orange-600 dark:text-orange-400">Due: ${reminder.dueDate}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-orange-700 dark:text-orange-300">${formatCurrency(reminder.amount)}</p>
                            <button onclick="deleteBillReminder(${reminder.id})" class="text-red-500 hover:text-red-700 text-xs">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function deleteBillReminder(id) {
            billReminders = billReminders.filter(r => r.id !== id);
            updateBillRemindersList();
            updateAll();
            showNotification('Bill reminder deleted!', 'success');
        }

        function addSavingsGoal() {
            showPromptDialog('Goal Name:', 'Emergency Fund', (name) => {
                if (!name) return;
                showPromptDialog('Target Amount:', '', (amount) => {
                    if (!amount) return;
                    showPromptDialog('Target Date (YYYY-MM-DD):', '', (targetDate) => {
                        if (!targetDate) return;
                        
                        const goal = {
                            id: Date.now(),
                            name,
                            targetAmount: parseFloat(amount),
                            currentAmount: 0,
                            targetDate,
                            createdDate: new Date().toISOString().split('T')[0]
                        };
                        
                        savingsGoals.push(goal);
                        updateSavingsGoalsList();
                        updateAll();
                        showNotification('Savings goal added successfully!', 'success');
                    });
                });
            });
        }

        function updateSavingsGoalsList() {
            const container = document.getElementById('savingsGoalsList');
            
            if (savingsGoals.length === 0) {
                container.innerHTML = '<p class="text-green-600 dark:text-green-400 text-center py-8">No savings goals set yet</p>';
                return;
            }

            container.innerHTML = savingsGoals.map(goal => {
                const progress = (goal.currentAmount / goal.targetAmount) * 100;
                const remaining = goal.targetAmount - goal.currentAmount;
                
                return `
                    <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-medium">${goal.name}</h4>
                            <span class="text-sm text-green-600 dark:text-green-400">${formatCurrency(goal.currentAmount)} / ${formatCurrency(goal.targetAmount)}</span>
                        </div>
                        <div class="w-full bg-green-200 dark:bg-green-800 rounded-full h-3 mb-2">
                            <div class="bg-green-600 h-3 rounded-full transition-all duration-300" style="width: ${Math.min(progress, 100)}%"></div>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span class="text-green-600 dark:text-green-400">Target: ${goal.targetDate}</span>
                            <span class="text-green-600 dark:text-green-400">${progress.toFixed(1)}% complete</span>
                        </div>
                        <div class="mt-2 flex space-x-2">
                            <button onclick="addToGoal(${goal.id})" class="text-xs bg-green-600 text-white px-2 py-1 rounded">Add Money</button>
                            <button onclick="deleteSavingsGoal(${goal.id})" class="text-xs bg-red-500 text-white px-2 py-1 rounded">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function addToGoal(goalId) {
            showPromptDialog('Amount to add:', '', (amount) => {
                if (!amount) return;
                
                const goal = savingsGoals.find(g => g.id === goalId);
                if (goal) {
                    goal.currentAmount += parseFloat(amount);
                    updateSavingsGoalsList();
                    updateAll();
                    showNotification('Amount added to goal!', 'success');
                }
            });
        }

        function deleteSavingsGoal(id) {
            savingsGoals = savingsGoals.filter(g => g.id !== id);
            updateSavingsGoalsList();
            updateAll();
            showNotification('Savings goal deleted!', 'success');
        }

        // Recurring Transactions
        function showRecurringTransactions() {
            showCustomModal('Recurring Transactions', 
                recurringTransactions.length > 0 
                    ? recurringTransactions.map(r => `
                        <div class="flex justify-between items-center p-2 border-b">
                            <div>
                                <strong>${r.description}</strong><br>
                                <small>${r.frequency} - ${formatCurrency(r.amount)}</small>
                            </div>
                            <button onclick="deleteRecurring(${r.id})" class="text-red-500">Delete</button>
                        </div>
                    `).join('')
                    : '<p>No recurring transactions set up</p>'
            );
        }

        function addRecurringTransaction() {
            showPromptDialog('Transaction Description:', 'Monthly Salary', (description) => {
                if (!description) return;
                showPromptDialog('Amount:', '', (amount) => {
                    if (!amount) return;
                    showPromptDialog('Type (income/expense):', 'income', (type) => {
                        if (!type) return;
                        showPromptDialog('Frequency (daily/weekly/monthly/yearly):', 'monthly', (frequency) => {
                            if (!frequency) return;
                            
                            const recurring = {
                                id: Date.now(),
                                description,
                                amount: parseFloat(amount),
                                type,
                                frequency,
                                category: type === 'income' ? '💼 Salary' : '🏠 Rent',
                                startDate: new Date().toISOString().split('T')[0],
                                lastProcessed: null
                            };
                            
                            recurringTransactions.push(recurring);
                            updateAll();
                            showNotification('Recurring transaction added!', 'success');
                        });
                    });
                });
            });
        }

        function deleteRecurring(id) {
            recurringTransactions = recurringTransactions.filter(r => r.id !== id);
            updateAll();
            showNotification('Recurring transaction deleted!', 'success');
        }

        // Import/Export Functions
        function exportData() {
            if (transactions.length === 0) {
                showNotification('No data to export', 'warning');
                return;
            }

            const data = {
                transactions,
                recurringTransactions,
                budgetLimits,
                investments,
                billReminders,
                savingsGoals,
                exportDate: new Date().toISOString(),
                version: '2.0'
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `budget-tracker-pro-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('Data exported successfully!', 'success');
            document.getElementById('menuDropdown').classList.add('hide');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (data.transactions) transactions = data.transactions;
                        if (data.recurringTransactions) recurringTransactions = data.recurringTransactions;
                        if (data.budgetLimits) budgetLimits = data.budgetLimits;
                        if (data.investments) investments = data.investments;
                        if (data.billReminders) billReminders = data.billReminders;
                        if (data.savingsGoals) savingsGoals = data.savingsGoals;
                        
                        updateAll();
                        showNotification('Data imported successfully!', 'success');
                    } catch (error) {
                        showNotification('Invalid file format', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
            document.getElementById('menuDropdown').classList.add('hide');
        }

        function backupToCloud() {
            showNotification('Cloud backup feature coming soon!', 'info');
            document.getElementById('menuDropdown').classList.add('hide');
        }

        // Calculator Functions
        function openCalculator() {
            document.getElementById('calculatorModal').classList.remove('hide');
            clearCalculator();
        }

        function closeCalculator() {
            document.getElementById('calculatorModal').classList.add('hide');
        }

        function appendToDisplay(value) {
            const display = document.getElementById('calculatorDisplay');
            if (display.value === '0' && value !== '.') {
                display.value = value;
            } else {
                display.value += value;
            }
        }

        function clearCalculator() {
            document.getElementById('calculatorDisplay').value = '0';
        }

        function deleteDigit() {
            const display = document.getElementById('calculatorDisplay');
            if (display.value.length > 1) {
                display.value = display.value.slice(0, -1);
            } else {
                display.value = '0';
            }
        }

        function calculate() {
            const display = document.getElementById('calculatorDisplay');
            try {
                const result = eval(display.value.replace('×', '*'));
                display.value = result.toString();
            } catch (error) {
                display.value = 'Error';
                setTimeout(clearCalculator, 1500);
            }
        }

        // Menu Functions
        function toggleMenu() {
            document.getElementById('menuDropdown').classList.toggle('hide');
        }

        function openPrivacyModal() {
            document.getElementById('privacyModal').classList.remove('hide');
            document.getElementById('menuDropdown').classList.add('hide');
        }

        function closePrivacyModal() {
            document.getElementById('privacyModal').classList.add('hide');
        }

        function showAbout() {
            showCustomModal('About Budget Tracker Pro', `
                <div class="space-y-4">
                    <p><strong>Budget Tracker Pro v2.0</strong></p>
                    <p>A comprehensive financial management tool with advanced features.</p>
                    
                    <h3 class="font-semibold text-lg">🚀 Advanced Features:</h3>
                    <ul class="space-y-1 text-sm">
                        <li>• 💡 Financial Health Score</li>
                        <li>• 🔄 Recurring Transactions</li>
                        <li>• 📊 Budget Limits & Alerts</li>
                        <li>• 📈 Investment Tracking</li>
                        <li>• ⏰ Bill Reminders</li>
                        <li>• 🎯 Multiple Savings Goals</li>
                        <li>• 🧠 Smart Insights</li>
                        <li>• 📱 Multi-language Support</li>
                        <li>• 🌙 Dark/Light Mode</li>
                        <li>• 💾 Data Import/Export</li>
                    </ul>
                    
                    <p class="text-center mt-4">
                        <strong>Made with ❤️ by Sagar</strong><br>
                        <span class="text-sm text-gray-600">Advanced Personal Finance Management</span>
                    </p>
                </div>
            `);
            document.getElementById('menuDropdown').classList.add('hide');
        }

        function toggleSearch() {
            const searchBar = document.getElementById('searchBar');
            searchBar.classList.toggle('hide');
            if (!searchBar.classList.contains('hide')) {
                document.getElementById('searchInput').focus();
            }
        }

        function handleSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                const filtered = transactions.filter(t => 
                    (t.description && t.description.toLowerCase().includes(searchTerm)) ||
                    t.category.toLowerCase().includes(searchTerm) ||
                    t.amount.toString().includes(searchTerm)
                );
                displayFilteredTransactions(filtered);
            } else {
                updateTransactionsList();
            }
        }

        function displayFilteredTransactions(filtered) {
            const container = document.getElementById('transactionsList');
            if (filtered.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No transactions found</p>';
            } else {
                container.innerHTML = filtered.map(transaction => `
                    <div class="transaction-item bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 card-hover">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-medium">${transaction.description || transaction.category}</h4>
                                <p class="text-sm text-gray-500 dark:text-gray-400">${transaction.date} • ${transaction.category}</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="font-bold ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                                    ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount)}
                                </span>
                                <div class="flex space-x-1">
                                    <button onclick="openEditModal(${JSON.stringify(transaction).replace(/"/g, '&quot;')})" class="p-1 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="openDeleteModal(${transaction.id})" class="p-1 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function openQuickAddModal(type) {
            openAddModal();
            document.getElementById('transactionType').value = type;
            updateCategoryOptions();
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 text-white max-w-sm ${
                type === 'success' ? 'bg-green-500' :
                type === 'warning' ? 'bg-yellow-500' :
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function showCustomModal(title, content) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-96 overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">${title}</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="prose dark:prose-invert max-w-none">${content}</div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            
            const confirmBtn = document.createElement('button');
            confirmBtn.className = 'px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded';
            confirmBtn.textContent = 'Confirm';
            confirmBtn.onclick = () => {
                modal.remove();
                onConfirm();
            };
            
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded';
            cancelBtn.textContent = 'Cancel';
            cancelBtn.onclick = () => modal.remove();
            
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3" id="dialogButtons">
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const buttonsContainer = modal.querySelector('#dialogButtons');
            buttonsContainer.appendChild(cancelBtn);
            buttonsContainer.appendChild(confirmBtn);
        }

        function showPromptDialog(message, defaultValue, onSubmit) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = defaultValue || '';
            input.className = 'w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base mb-4';
            
            const okBtn = document.createElement('button');
            okBtn.className = 'px-4 py-2 bg-primary text-white hover:bg-primary-dark rounded';
            okBtn.textContent = 'OK';
            okBtn.onclick = () => {
                const value = input.value.trim();
                modal.remove();
                if (value) onSubmit(value);
            };
            
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded';
            cancelBtn.textContent = 'Cancel';
            cancelBtn.onclick = () => modal.remove();
            
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    okBtn.click();
                }
            });
            
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div id="inputContainer"></div>
                    <div class="flex justify-end space-x-3" id="dialogButtons">
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const inputContainer = modal.querySelector('#inputContainer');
            const buttonsContainer = modal.querySelector('#dialogButtons');
            inputContainer.appendChild(input);
            buttonsContainer.appendChild(cancelBtn);
            buttonsContainer.appendChild(okBtn);
            input.focus();
        }
    </script>
</body>
</html>